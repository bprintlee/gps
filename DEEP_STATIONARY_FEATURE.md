# 深度静止状态功能说明

## 功能概述

深度静止状态是一个新增的省电功能，当手机在室内环境下长时间没有移动时，会自动进入此状态以大幅降低功耗。

## 工作原理

### 进入条件
- 当前状态为室内模式
- 连续5分钟（300秒）没有检测到明显移动
- 步数没有显著增加
- 加速度传感器没有检测到明显变化

### 退出条件
- 步数增加30步或以上
- 检测到明显的加速度变化（步行或驾车）
- 退出后自动恢复到室内状态并进行环境检测

## 功耗优化策略

### 深度静止状态下的优化
1. **停止GPS更新** - 完全停止GPS定位以节省电量
2. **降低传感器频率** - 使用SENSOR_DELAY_NORMAL延迟
3. **减少状态检查频率** - 将检查间隔从5秒增加到10秒
4. **仅监测关键传感器** - 只监测步数计数器和加速度传感器

### 预期省电效果
- GPS模块完全关闭，节省约30-50%的定位相关功耗
- 传感器频率降低，节省约20-30%的传感器功耗
- 状态检查频率降低，节省约10-15%的CPU功耗
- 总体预期节省约40-60%的电池消耗

## 配置参数

```kotlin
// 深度静止状态配置
private val deepStationaryTimeoutMs = 300000L // 5分钟无移动进入深度静止
private val deepStationaryStepThreshold = 30 // 30步阈值退出深度静止
private val deepStationaryAccelerationThreshold = 1.5f // 深度静止状态加速度阈值
```

## 状态转换图

```
室内状态 → [5分钟无移动] → 深度静止状态
    ↑                           ↓
    ← [30步或明显加速度] ← ← ← ← ←
```

## 监测和统计

### 新增的监测方法
- `isInDeepStationary()` - 检查是否处于深度静止状态
- `getStepIncreaseSinceDeepStationary()` - 获取进入深度静止后的步数增加
- `getTimeInDeepStationary()` - 获取当前深度静止状态的持续时间
- `getTotalDeepStationaryTime()` - 获取累计深度静止时间
- `getDeepStationaryConfig()` - 获取深度静止状态配置

### 日志输出
- 进入深度静止状态时会记录步数和加速度值
- 退出深度静止状态时会记录步数增加和持续时间
- 深度静止状态下会定期记录监测数据

## 使用场景

### 适用场景
- 办公室工作
- 家庭休息
- 长时间会议
- 夜间睡眠
- 任何长时间静止的室内环境

### 不适用场景
- 户外活动
- 驾驶状态
- 需要持续定位的场景

## 技术实现细节

### 传感器监测优化
- 使用平滑算法减少加速度传感器的噪声
- 步数计数器采用增量监测，避免累积误差
- 智能传感器频率调整

### 状态管理
- 完整的状态转换逻辑
- 自动环境检测和GPS重启
- 统计信息收集和分析

### 功耗管理
- 动态调整传感器更新频率
- 智能GPS开关控制
- 状态检查频率优化

## 注意事项

1. **权限要求** - 需要ACTIVITY_RECOGNITION权限用于步数监测
2. **传感器依赖** - 依赖设备的步数计数器和加速度传感器
3. **环境检测** - 退出深度静止状态后会重新进行环境检测
4. **数据完整性** - 深度静止状态下不会丢失GPS数据，只是暂停收集

## 未来优化方向

1. **机器学习** - 基于用户行为模式优化进入/退出阈值
2. **个性化配置** - 允许用户自定义深度静止状态参数
3. **智能预测** - 预测用户移动模式，提前调整状态
4. **更精细的功耗控制** - 进一步优化传感器和系统资源使用

## 测试建议

1. 在室内环境下测试进入深度静止状态
2. 验证步数增加30步后能正确退出
3. 测试加速度变化检测的准确性
4. 监控电池消耗的改善情况
5. 验证GPS重启和环境检测功能
