# GPS调用和保存逻辑总结

## 新的GPS调用间隔配置

根据不同的跟踪状态，GPS调用间隔如下：

### 1. 活跃模式 (ACTIVE)
- **GPS调用间隔**: 10秒
- **精度模式**: OUTDOOR_ACTIVITY
- **配置**: 高精度，2秒最快间隔，1米最小位移

### 2. 驾驶模式 (DRIVING)  
- **GPS调用间隔**: 4秒
- **精度模式**: DRIVING (新增)
- **配置**: 高精度，2秒最快间隔，1米最小位移

### 3. 室内模式 (INDOOR)
- **GPS调用间隔**: 1分钟 (60秒)
- **精度模式**: INDOOR_NAVIGATION
- **配置**: 低功耗，30秒最快间隔，10米最小位移

### 4. 其他模式
- **省电模式**: 使用POWER_SAVE模式
- **智能推荐**: 根据环境自动选择最佳模式

## 新的保存和上报逻辑

### 实时保存策略
- **每次GPS位置更新**: 立即检查精度
- **精度符合要求**: 立即保存到GPX文件和上报到MQTT
- **精度不符合要求**: 跳过处理，记录日志

### 精度要求
- **MQTT上报**: 精度 < 60米
- **保存到文件**: 精度 != UNRELIABLE (即精度 <= 50米且时间 <= 60秒)

### 移除的功能
- 批量保存机制
- 定时保存任务
- 基于数量的保存阈值

## 状态切换逻辑

### 活跃状态切换到室内状态
- **时间条件**: 活跃状态持续5分钟后开始检测
- **距离条件**: 当前与5分钟前位置距离 ≤ 200米
- **GPS超时条件**: 45秒内没有GPS信号
- **满足任一条件**: 切换到室内状态

### 驾驶状态检测
- **进入条件**: GPS速度 ≥ 7km/h
- **退出条件**: 5分钟内移动距离 < 100米

## 优化效果

1. **响应速度**: 每次符合精度要求的结果都立即处理
2. **数据完整性**: 不再丢失GPS点，实时保存
3. **电量优化**: 根据状态调整GPS调用频率
4. **精度保证**: 只处理和保存符合精度要求的数据

## 日志输出

新增详细的调试日志，包括：
- GPS调用间隔信息
- 精度检查结果
- 保存和上报状态
- 状态切换原因
- 位置历史记录信息
